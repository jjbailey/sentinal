# /backups/jjb/backups.ini

# example INI file that implements a simple backup scheme using sentinal
# backup home in 5GB (compressed) chunks
# file by date
# keep backups for 2 weeks, the newest 7 indefinately

# prep:
# mkdir -p /backups/jjb && chown jjb:users /backups/jjb
# cp backups.ini /backups/jjb/backups.ini

# verify:
# /opt/sentinal/bin/sentinal -f /backups/jjb/backups.ini -v

# jjb's crontab entry:
# 30 02 * * * tar -cf /backups/jjb/home.fifo . >/dev/null 2>&1

[global]
pidfile  = /backups/jjb/backups.pid

[home]
command  = /usr/bin/zstd -T6 --zstd=strat=2 --long
dirname  = /backups/jjb
subdirs  = 1
pipename = home.fifo
template = home-%F_%H-%M-%S.tar.zst
pcrestr  = home-\d
uid      = jjb
gid      = users
loglimit = 5G
diskfree = 20
inofree  = 
expire   = 2w
retmin   = 7
retmax   = 0
postcmd  = dir=%t-$(date +%Y-%m) ; mkdir -p $dir ; mv %n $dir

# /etc/systemd/system/jjbhome.service

#[Unit]
#Description=sentinal backup service for jjb
#StartLimitBurst=10
#StartLimitIntervalSec=0
#After=network.target network-online.target systemd-networkd.service
#
#[Service]
#Type=simple
#Restart=always
#RestartSec=1
#User=root
#ExecStart=/opt/sentinal/bin/sentinal -f /backups/jjb/backups.ini
#ExecReload=/bin/kill -s HUP $MAINPID
#
#[Install]
#WantedBy=multi-user.target
